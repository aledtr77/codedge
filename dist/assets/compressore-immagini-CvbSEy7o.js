/*!
 * Compressor.js v1.2.1
 * https://fengyuanchen.github.io/compressorjs
 *
 * Copyright 2018-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2023-02-28T14:09:41.732Z
 */function se(a,e){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(a);e&&(t=t.filter(function(n){return Object.getOwnPropertyDescriptor(a,n).enumerable})),r.push.apply(r,t)}return r}function z(a){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?se(Object(r),!0).forEach(function(t){Ce(a,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(r,t))})}return a}function Be(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function le(a,e){for(var r=0;r<e.length;r++){var t=e[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,ve(t.key),t)}}function Ie(a,e,r){return e&&le(a.prototype,e),r&&le(a,r),Object.defineProperty(a,"prototype",{writable:!1}),a}function Ce(a,e,r){return e=ve(e),e in a?Object.defineProperty(a,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[e]=r,a}function M(){return M=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(a[t]=r[t])}return a},M.apply(this,arguments)}function Re(a,e){if(typeof a!="object"||a===null)return a;var r=a[Symbol.toPrimitive];if(r!==void 0){var t=r.call(a,e);if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(a)}function ve(a){var e=Re(a,"string");return typeof e=="symbol"?e:String(e)}var ge={exports:{}};(function(a){typeof window>"u"||function(e){var r=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,t=e.Blob&&function(){try{return!!new Blob}catch{return!1}}(),n=t&&e.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch{return!1}}(),o=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,h=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,u=(t||o)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(l){var c,v,g,w,m,s,b,y,I;if(c=l.match(h),!c)throw new Error("invalid data URI");for(v=c[2]?c[1]:"text/plain"+(c[3]||";charset=US-ASCII"),g=!!c[4],w=l.slice(c[0].length),g?m=atob(w):m=decodeURIComponent(w),s=new ArrayBuffer(m.length),b=new Uint8Array(s),y=0;y<m.length;y+=1)b[y]=m.charCodeAt(y);return t?new Blob([n?b:s],{type:v}):(I=new o,I.append(s),I.getBlob(v))};e.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(l,c,v){var g=this;setTimeout(function(){v&&r.toDataURL&&u?l(u(g.toDataURL(c,v))):l(g.mozGetAsFile("blob",c))})}:r.toDataURL&&u&&(r.msToBlob?r.toBlob=function(l,c,v){var g=this;setTimeout(function(){(c&&c!=="image/png"||v)&&r.toDataURL&&u?l(u(g.toDataURL(c,v))):l(g.msToBlob(c))})}:r.toBlob=function(l,c,v){var g=this;setTimeout(function(){l(u(g.toDataURL(c,v)))})})),a.exports?a.exports=u:e.dataURLtoBlob=u}(window)})(ge);var ce=ge.exports,Ee=function(e){return typeof Blob>"u"?!1:e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"},ue={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},Ue=typeof window<"u"&&typeof window.document<"u",E=Ue?window:{},W=function(e){return e>0&&e<1/0},Te=Array.prototype.slice;function N(a){return Array.from?Array.from(a):Te.call(a)}var Le=/^image\/.+$/;function K(a){return Le.test(a)}function Oe(a){var e=K(a)?a.substr(6):"";return e==="jpeg"&&(e="jpg"),".".concat(e)}var pe=String.fromCharCode;function Fe(a,e,r){var t="",n;for(r+=e,n=e;n<r;n+=1)t+=pe(a.getUint8(n));return t}var De=E.btoa;function fe(a,e){for(var r=[],t=8192,n=new Uint8Array(a);n.length>0;)r.push(pe.apply(null,N(n.subarray(0,t)))),n=n.subarray(t);return"data:".concat(e,";base64,").concat(De(r.join("")))}function Ae(a){var e=new DataView(a),r;try{var t,n,o;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var h=e.byteLength,u=2;u+1<h;){if(e.getUint8(u)===255&&e.getUint8(u+1)===225){n=u;break}u+=1}if(n){var l=n+4,c=n+10;if(Fe(e,l,4)==="Exif"){var v=e.getUint16(c);if(t=v===18761,(t||v===19789)&&e.getUint16(c+2,t)===42){var g=e.getUint32(c+4,t);g>=8&&(o=c+g)}}}if(o){var w=e.getUint16(o,t),m,s;for(s=0;s<w;s+=1)if(m=o+s*12+2,e.getUint16(m,t)===274){m+=8,r=e.getUint16(m,t),e.setUint16(m,1,t);break}}}catch{r=1}return r}function ke(a){var e=0,r=1,t=1;switch(a){case 2:r=-1;break;case 3:e=-180;break;case 4:t=-1;break;case 5:e=90,t=-1;break;case 6:e=90;break;case 7:e=90,r=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:r,scaleY:t}}var je=/\.\d*(?:0|9){12}\d*$/;function me(a){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return je.test(a)?Math.round(a*e)/e:a}function P(a){var e=a.aspectRatio,r=a.height,t=a.width,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"none",o=W(t),h=W(r);if(o&&h){var u=r*e;(n==="contain"||n==="none")&&u>t||n==="cover"&&u<t?r=t/e:t=r*e}else o?r=t/e:h&&(t=r*e);return{width:t,height:r}}function Pe(a){for(var e=N(new Uint8Array(a)),r=e.length,t=[],n=0;n+3<r;){var o=e[n],h=e[n+1];if(o===255&&h===218)break;if(o===255&&h===216)n+=2;else{var u=e[n+2]*256+e[n+3],l=n+u+2,c=e.slice(n,l);t.push(c),n=l}}return t.reduce(function(v,g){return g[0]===255&&g[1]===225?v.concat(g):v},[])}function ze(a,e){var r=N(new Uint8Array(a));if(r[2]!==255||r[3]!==224)return a;var t=r[4]*256+r[5],n=[255,216].concat(e,r.slice(4+t));return new Uint8Array(n)}var Me=E.ArrayBuffer,V=E.FileReader,O=E.URL||E.webkitURL,We=/\.\w+$/,$e=E.Compressor,he=function(){function a(e,r){Be(this,a),this.file=e,this.exif=[],this.image=new Image,this.options=z(z({},ue),r),this.aborted=!1,this.result=null,this.init()}return Ie(a,[{key:"init",value:function(){var r=this,t=this.file,n=this.options;if(!Ee(t)){this.fail(new Error("The first argument must be a File or Blob object."));return}var o=t.type;if(!K(o)){this.fail(new Error("The first argument must be an image File or Blob object."));return}if(!O||!V){this.fail(new Error("The current browser does not support image compression."));return}Me||(n.checkOrientation=!1,n.retainExif=!1);var h=o==="image/jpeg",u=h&&n.checkOrientation,l=h&&n.retainExif;if(O&&!u&&!l)this.load({url:O.createObjectURL(t)});else{var c=new V;this.reader=c,c.onload=function(v){var g=v.target,w=g.result,m={},s=1;u&&(s=Ae(w),s>1&&M(m,ke(s))),l&&(r.exif=Pe(w)),u||l?!O||s>1?m.url=fe(w,o):m.url=O.createObjectURL(t):m.url=w,r.load(m)},c.onabort=function(){r.fail(new Error("Aborted to read the image with FileReader."))},c.onerror=function(){r.fail(new Error("Failed to read the image with FileReader."))},c.onloadend=function(){r.reader=null},u||l?c.readAsArrayBuffer(t):c.readAsDataURL(t)}}},{key:"load",value:function(r){var t=this,n=this.file,o=this.image;o.onload=function(){t.draw(z(z({},r),{},{naturalWidth:o.naturalWidth,naturalHeight:o.naturalHeight}))},o.onabort=function(){t.fail(new Error("Aborted to load the image."))},o.onerror=function(){t.fail(new Error("Failed to load the image."))},E.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(E.navigator.userAgent)&&(o.crossOrigin="anonymous"),o.alt=n.name,o.src=r.url}},{key:"draw",value:function(r){var t=this,n=r.naturalWidth,o=r.naturalHeight,h=r.rotate,u=h===void 0?0:h,l=r.scaleX,c=l===void 0?1:l,v=r.scaleY,g=v===void 0?1:v,w=this.file,m=this.image,s=this.options,b=document.createElement("canvas"),y=b.getContext("2d"),I=Math.abs(u)%180===90,A=(s.resize==="contain"||s.resize==="cover")&&W(s.width)&&W(s.height),U=Math.max(s.maxWidth,0)||1/0,T=Math.max(s.maxHeight,0)||1/0,C=Math.max(s.minWidth,0)||0,i=Math.max(s.minHeight,0)||0,p=n/o,f=s.width,d=s.height;if(I){var B=[T,U];U=B[0],T=B[1];var R=[i,C];C=R[0],i=R[1];var L=[d,f];f=L[0],d=L[1]}A&&(p=f/d);var x=P({aspectRatio:p,width:U,height:T},"contain");U=x.width,T=x.height;var X=P({aspectRatio:p,width:C,height:i},"cover");if(C=X.width,i=X.height,A){var q=P({aspectRatio:p,width:f,height:d},s.resize);f=q.width,d=q.height}else{var Y=P({aspectRatio:p,width:f,height:d}),J=Y.width;f=J===void 0?n:J;var _=Y.height;d=_===void 0?o:_}f=Math.floor(me(Math.min(Math.max(f,C),U))),d=Math.floor(me(Math.min(Math.max(d,i),T)));var ye=-f/2,be=-d/2,we=f,xe=d,$=[];if(A){var Q=0,Z=0,H=n,S=o,ee=P({aspectRatio:p,width:n,height:o},{contain:"cover",cover:"contain"}[s.resize]);H=ee.width,S=ee.height,Q=(n-H)/2,Z=(o-S)/2,$.push(Q,Z,H,S)}if($.push(ye,be,we,xe),I){var te=[d,f];f=te[0],d=te[1]}b.width=f,b.height=d,K(s.mimeType)||(s.mimeType=w.type);var re="transparent";w.size>s.convertSize&&s.convertTypes.indexOf(s.mimeType)>=0&&(s.mimeType="image/jpeg");var ae=s.mimeType==="image/jpeg";if(ae&&(re="#fff"),y.fillStyle=re,y.fillRect(0,0,f,d),s.beforeDraw&&s.beforeDraw.call(this,y,b),!this.aborted&&(y.save(),y.translate(f/2,d/2),y.rotate(u*Math.PI/180),y.scale(c,g),y.drawImage.apply(y,[m].concat($)),y.restore(),s.drew&&s.drew.call(this,y,b),!this.aborted)){var ie=function(k){if(!t.aborted){var ne=function(j){return t.done({naturalWidth:n,naturalHeight:o,result:j})};if(k&&ae&&s.retainExif&&t.exif&&t.exif.length>0){var oe=function(j){return ne(ce(fe(ze(j,t.exif),s.mimeType)))};if(k.arrayBuffer)k.arrayBuffer().then(oe).catch(function(){t.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var F=new V;t.reader=F,F.onload=function(G){var j=G.target;oe(j.result)},F.onabort=function(){t.fail(new Error("Aborted to read the compressed image with FileReader."))},F.onerror=function(){t.fail(new Error("Failed to read the compressed image with FileReader."))},F.onloadend=function(){t.reader=null},F.readAsArrayBuffer(k)}}else ne(k)}};b.toBlob?b.toBlob(ie,s.mimeType,s.quality):ie(ce(b.toDataURL(s.mimeType,s.quality)))}}},{key:"done",value:function(r){var t=r.naturalWidth,n=r.naturalHeight,o=r.result,h=this.file,u=this.image,l=this.options;if(O&&u.src.indexOf("blob:")===0&&O.revokeObjectURL(u.src),o)if(l.strict&&!l.retainExif&&o.size>h.size&&l.mimeType===h.type&&!(l.width>t||l.height>n||l.minWidth>t||l.minHeight>n||l.maxWidth<t||l.maxHeight<n))o=h;else{var c=new Date;o.lastModified=c.getTime(),o.lastModifiedDate=c,o.name=h.name,o.name&&o.type!==h.type&&(o.name=o.name.replace(We,Oe(o.type)))}else o=h;this.result=o,l.success&&l.success.call(this,o)}},{key:"fail",value:function(r){var t=this.options;if(t.error)t.error.call(this,r);else throw r}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=$e,a}},{key:"setDefaults",value:function(r){M(ue,r)}}]),a}();let de=!1,D=null;function Se(){if(de)return;de=!0;const a=document.getElementById("fileInput"),e=document.getElementById("uploadArea"),r=document.getElementById("compressBtn"),t=document.getElementById("result"),n=document.getElementById("originalImageContainer"),o=document.getElementById("compressedImageContainer"),h=document.getElementById("outputFormat"),u=document.getElementById("quality"),l=document.getElementById("maxWidth"),c=document.getElementById("qualityFill"),v=document.getElementById("maxWidthFill"),g=document.getElementById("qualityValue"),w=document.getElementById("maxWidthValue"),m=document.getElementById("saveToButton");if(!a||!r||!t){console.error("[compressore-immagini] Elementi fondamentali mancanti.");return}D=null,r&&(r.disabled=!0),m&&(m.disabled=!0);const s=i=>(i/1024).toFixed(2);function b(i){if(!i||!i.length)return;const p=i[0];if(!p.type.startsWith("image/")){t.textContent="Per favore seleziona un'immagine valida.";return}r.disabled=!1,y(p),D=null,m&&(m.disabled=!0),o&&(o.innerHTML=""),t.textContent=""}function y(i){const p=new FileReader;p.onload=f=>{const d=new Image;d.onload=function(){var R;const B=((R=i.type.split("/")[1])==null?void 0:R.toUpperCase())||"IMG";n&&(n.innerHTML=`
            <img src="${f.target.result}" alt="Immagine originale">
            <p>Originale (${B}): ${s(i.size)} KB</p>
            <p>Risoluzione: ${this.width} x ${this.height} px</p>
          `)},d.src=f.target.result},p.readAsDataURL(i)}function I(i){const p=new FileReader;p.onload=f=>{const d=new Image;d.onload=function(){o&&(o.innerHTML=`
            <img src="${f.target.result}" alt="Immagine compressa">
            <p>Compressa (${((h==null?void 0:h.value)||"").toUpperCase()}): ${s(i.size)} KB</p>
            <p>Risoluzione: ${this.width} x ${this.height} px</p>
          `)},d.src=f.target.result},p.readAsDataURL(i)}async function A(){var p;const i=(p=a.files)==null?void 0:p[0];if(i)try{t.textContent="Compressione e conversione in corso...";const f=Math.max(0,Math.min(1,parseFloat((u==null?void 0:u.value)??"80")/100)),d=parseInt((l==null?void 0:l.value)??"1200",10),B=((h==null?void 0:h.value)||"jpeg").toLowerCase(),L=`image/${B==="jpg"?"jpeg":B}`;if(typeof he!="function")throw new Error("CompressorJS non trovato. Installa 'compressorjs' o includi il CDN.");new he(i,{quality:f,maxWidth:d,mimeType:L,success(x){x.size<i.size?(D=x,I(x),t.textContent=`Operazione completata! Dimensione ridotta da ${s(i.size)} KB a ${s(x.size)} KB`):(D=i,I(i),t.textContent=`Qualità/larghezza invariati: mantengo l'originale. Dimensione: ${s(i.size)} KB`),m&&(m.disabled=!1)},error(x){t.textContent="Errore durante l'elaborazione: "+x.message,m&&(m.disabled=!0)}})}catch(f){t.textContent="Errore durante l'elaborazione: "+f.message,m&&(m.disabled=!0)}}function U(){if(!D)return;const i=document.createElement("a");i.href=URL.createObjectURL(D),i.download=`compressed_image.${((h==null?void 0:h.value)||"jpeg").toLowerCase()}`,document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout(()=>URL.revokeObjectURL(i.href),2e3)}function T(i,p){if(!i||!p)return;const f=(i.value-i.min)/(i.max-i.min)*100;p.style.width=`${f}%`}function C(i,p,f,d){if(!i)return;const B=R=>{const L=parseFloat(R),x=isNaN(L)?parseFloat(i.value):Math.min(Math.max(L,parseFloat(i.min)),parseFloat(i.max));i.value=x,f&&(f.value=`${x}${d}`),T(i,p)};i.addEventListener("input",()=>B(i.value)),f==null||f.addEventListener("change",function(){B(this.value)}),B(i.value)}e==null||e.addEventListener("click",()=>a.click()),e==null||e.addEventListener("dragover",i=>{i.preventDefault(),e.style.backgroundColor="#2a2a2a"}),e==null||e.addEventListener("dragleave",()=>{e.style.backgroundColor=""}),e==null||e.addEventListener("drop",i=>{i.preventDefault(),e.style.backgroundColor="",b(i.dataTransfer.files)}),a.addEventListener("change",i=>b(i.target.files)),r.addEventListener("click",A),m==null||m.addEventListener("click",U),C(u,c,g,"%"),C(l,v,w,"px")}export{Se as initImageCompressor};
