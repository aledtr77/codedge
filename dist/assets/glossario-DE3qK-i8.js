document.addEventListener("DOMContentLoaded",function(){const a=document.getElementById("search"),y=document.querySelectorAll(".clickable-item"),v=document.getElementsByTagName("details"),m=document.querySelector("header");document.querySelector(".menu-icon"),document.querySelector(".nav-menu");const l=document.querySelector(".sidebar-toggle"),e=document.querySelector("aside"),f=document.querySelector(".main-content");let o=m?m.offsetHeight:0;function p(){o=m?m.offsetHeight:0}window.addEventListener("resize",p);const b=new IntersectionObserver(t=>{t.forEach(i=>{if(i.isIntersecting){const c=i.target;c.hasAttribute("data-loaded")||(c.setAttribute("data-loaded","true"),b.unobserve(c))}})},{rootMargin:"200px"});function h(){const t=a.value.toLowerCase().trim();let i=null,c=null;Array.from(v).forEach(s=>{const n=s.querySelector("summary"),r=n.textContent||n.innerText;t===""?s.open=!1:s.hasAttribute("data-priority")&&r.toLowerCase().startsWith(t)?(s.open=!0,c||(c=s)):r.toLowerCase().startsWith(t)?(s.open=!0,i||(i=s)):s.open=!1,s.open&&!s.hasAttribute("data-loaded")&&s.setAttribute("data-loaded","true")});const d=c||i;d&&setTimeout(()=>{p();const s=-o-0,n=d.getBoundingClientRect().top+window.pageYOffset+s;window.scrollTo({top:n,behavior:"smooth"})},100)}Array.from(v).forEach(t=>b.observe(t)),a&&a.addEventListener("input",h),y&&y.forEach&&y.forEach(t=>{t.addEventListener("click",function(){const i=this.textContent.trim();a&&(a.value=i,setTimeout(()=>{h();const c=new Event("input",{bubbles:!0,cancelable:!0});a.dispatchEvent(c)},0)),window.innerWidth<=768&&e&&l&&(e.classList.remove("active"),l.classList.remove("active"))})}),window.copyCode=function(t){const i=t.closest(".code-container").querySelector("code"),c=document.createElement("textarea");c.value=i.innerText,document.body.appendChild(c),c.select(),document.execCommand("copy"),document.body.removeChild(c);const d=t.innerHTML,s=t.querySelector("i")?t.querySelector("i").outerHTML:"";t.innerHTML=s+" Copiato!",setTimeout(()=>{t.innerHTML=d},2e3)},l&&e&&f&&(l.addEventListener("click",function(){this.classList.toggle("active"),e.classList.toggle("active"),f.classList.toggle("aside-open")}),document.addEventListener("click",function(t){!e.contains(t.target)&&!l.contains(t.target)&&e.classList.contains("active")&&window.innerWidth<=768&&(l.classList.remove("active"),e.classList.remove("active"),f.classList.remove("aside-open"))}));let g=[];window.addEventListener("blur",function(){g=Array.from(v).map(t=>t.open)}),window.addEventListener("focus",function(){p(),Array.from(v).forEach((t,i)=>{t.open=g[i]||!1})}),window.addEventListener("beforeunload",function(){a&&(a.value="")}),setTimeout(h,300)});const w=document.querySelectorAll(".logo"),E=document.querySelectorAll(".invisible-text, .resize-text");function x(){window.innerWidth<1200?(w.forEach(a=>a.style.display="none"),E.forEach(a=>a.style.display="none")):(w.forEach(a=>a.style.display=""),E.forEach(a=>a.style.display=""))}window.addEventListener("resize",x);x();(function(){const y=[".menu-icon",".menu-toggle",".menu-btn",".nav-toggle",".hamburger",".menu-button","#menuBtn"],v=[".nav-menu",".navbar .nav-menu",".navbar","nav","#mainNav",".main-nav"],m=n=>n.map(r=>document.querySelector(r)).find(Boolean)||null,l=m(y),e=m(v),f=document.querySelector("header");if(!l||!e){console.warn("replaceHamburgerHandler: bottone o nav non trovati",l,e);return}const o=l.cloneNode(!0);l.parentNode.replaceChild(o,l),console.log("replaceHamburgerHandler: bottone clonato â€” listeners precedenti rimossi.");function p(n){if(!n)return!1;const r=getComputedStyle(n),u=n.getBoundingClientRect();return r.display!=="none"&&r.visibility!=="hidden"&&parseFloat(r.opacity||"1")>0&&u.height>2&&u.width>2}function b(n){if(!n)return{};const r=["position","top","left","right","zIndex","display","maxHeight","overflowY","background","visibility","opacity","transform"],u={};return r.forEach(L=>u[L]=n.style[L]||""),u}function h(n,r){!n||!r||Object.keys(r).forEach(u=>n.style[u]=r[u]||"")}const g=f&&f.offsetHeight?f.offsetHeight:56,t=window.matchMedia("(max-width: 1180px)");let i=null;function c(){t.matches&&(i||(i=b(e)),e.style.display="flex",e.style.position="fixed",e.style.top=g+"px",e.style.left="0",e.style.right="0",e.style.zIndex="2200",e.style.background=getComputedStyle(e).backgroundColor||"white",e.style.maxHeight="calc(100vh - "+g+"px)",e.style.overflowY="auto")}function d(){i&&(h(e,i),i=null)}function s(){!o.classList.contains("active")?(o.classList.add("active"),e.classList.add("active","open","show"),document.body.classList.add("menu-open"),o.setAttribute("aria-expanded","true")):(o.classList.remove("active"),e.classList.remove("active","open","show"),document.body.classList.remove("menu-open"),o.setAttribute("aria-expanded","false")),setTimeout(()=>{o.classList.contains("active")?p(e)?d():(c(),console.info("replaceHamburgerHandler: fallback inline applicato (mobile).")):(d(),t.matches&&p(e)&&(e.style.display="none"))},80)}o.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),s()},{passive:!1}),e.addEventListener("click",function(n){n.target.closest("a")&&(o.classList.remove("active"),e.classList.remove("active","open","show"),document.body.classList.remove("menu-open"),o.setAttribute("aria-expanded","false"),d())}),document.addEventListener("click",function(n){!e.contains(n.target)&&!o.contains(n.target)&&e.classList.contains("active")&&(o.classList.remove("active"),e.classList.remove("active","open","show"),document.body.classList.remove("menu-open"),o.setAttribute("aria-expanded","false"),d())}),o.style.zIndex=o.style.zIndex||"2600",console.log("replaceHamburgerHandler: nuovo handler installato con successo.")})();
